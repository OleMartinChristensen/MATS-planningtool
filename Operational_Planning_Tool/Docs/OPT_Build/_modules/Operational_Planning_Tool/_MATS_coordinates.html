
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="python 3.7">
  <head>
    <meta charset="utf-8" />
    <title>Operational_Planning_Tool._MATS_coordinates &#8212; Operational_Planning_Tool  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Operational_Planning_Tool._MATS_coordinates</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">##########################################</span>

<span class="c1">#Library for handling coordinate system tranforms for the MATS mission</span>

<span class="c1">##########################################</span>



<span class="c1">#Created 17.07.27 Ole Martin Christensen</span>





<span class="c1">#</span>

<span class="c1">#</span>

<span class="c1"># Output </span>

<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">pylab</span>

<span class="c1">#import numpy.transformations as tp</span>

<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">EarthLocation</span><span class="p">,</span> <span class="n">GCRS</span><span class="p">,</span> <span class="n">CartesianRepresentation</span><span class="p">,</span> <span class="n">ITRS</span><span class="p">,</span> <span class="n">get_sun</span><span class="p">,</span> <span class="n">AltAz</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">units</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">time</span> <span class="k">as</span> <span class="n">time</span>



<span class="kn">from</span> <span class="nn">astroquery.vizier</span> <span class="k">import</span> <span class="n">Vizier</span>

<span class="kn">import</span> <span class="nn">astropy.coordinates</span> <span class="k">as</span> <span class="nn">coord</span>





<div class="viewcode-block" id="ecef2tanpoint"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.ecef2tanpoint">[docs]</a><span class="k">def</span> <span class="nf">ecef2tanpoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">):</span>

    

<span class="c1">#This function takes a position and look vector in ECEF system and returns the tangent point</span>

<span class="c1">#(point closest to the ellipsiod) for the WGS-84 ellipsiod in ECEF coordinates.</span>

<span class="c1">#The algorithm used is derived by Nick Lloyd at University of Saskatchewan, </span>

<span class="c1">#Canada (nick.lloyd@usask.ca), and is part of</span>

<span class="c1">#the operational code for both OSIRIS and SMR on-board- the Odin satellite.</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># x = ECEF X-coordinate (m)</span>

<span class="c1"># y = ECEF Y-coordinate (m)</span>

<span class="c1"># z = ECEF Z-coordinate (m)</span>

<span class="c1"># dx = ECEF look vector X-coordinate (m)</span>

<span class="c1"># dy = ECEF look vector Y-coordinate (m)</span>

<span class="c1"># dz = ECEF look vector Z-coordinate (m</span>



<span class="c1"># Output</span>

<span class="c1"># tx = ECEF X-coordinate of tangentpoint (m)</span>

<span class="c1"># ty = ECEF Y-coordinate of tangentpoint (m)</span>

<span class="c1"># tz = ECEF Z-coordinate of tangentpoint (m)</span>



<span class="c1">#FIXME check normalization of dx,dy,dz!</span>





     <span class="c1">#WGS-84 semi-major axis and eccentricity</span>

     <span class="n">a</span><span class="o">=</span><span class="mi">6378137</span>

     <span class="n">e</span><span class="o">=</span><span class="mf">0.081819190842621</span>

     

     <span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>

     <span class="n">b2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

     <span class="n">X</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>

  

     <span class="n">xunit</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">])</span>

  

     <span class="n">zunit</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">xunit</span><span class="p">,</span> <span class="n">X</span> <span class="p">)</span>

     <span class="n">zunit</span> <span class="o">=</span> <span class="n">zunit</span> <span class="o">/</span> <span class="n">pylab</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">zunit</span><span class="p">)</span>

 	

     <span class="n">yunit</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">zunit</span><span class="p">,</span> <span class="n">xunit</span> <span class="p">)</span>

     <span class="n">yunit</span> <span class="o">=</span> <span class="n">yunit</span> <span class="o">/</span> <span class="n">pylab</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yunit</span><span class="p">)</span>

  

     <span class="n">w11</span> <span class="o">=</span> <span class="n">xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

     <span class="n">w12</span> <span class="o">=</span> <span class="n">yunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

     <span class="n">w21</span> <span class="o">=</span> <span class="n">xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

     <span class="n">w22</span> <span class="o">=</span> <span class="n">yunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

     <span class="n">w31</span> <span class="o">=</span> <span class="n">xunit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

     <span class="n">w32</span> <span class="o">=</span> <span class="n">yunit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

     <span class="n">yr</span>  <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">yunit</span> <span class="p">)</span>

     <span class="n">xr</span>  <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">xunit</span> <span class="p">)</span>

 	   

     <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">w11</span><span class="o">*</span><span class="n">w11</span> <span class="o">+</span> <span class="n">w21</span><span class="o">*</span><span class="n">w21</span><span class="p">)</span><span class="o">/</span><span class="n">a2</span> <span class="o">+</span> <span class="n">w31</span><span class="o">*</span><span class="n">w31</span><span class="o">/</span><span class="n">b2</span>

     <span class="n">B</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">((</span><span class="n">w11</span><span class="o">*</span><span class="n">w12</span> <span class="o">+</span> <span class="n">w21</span><span class="o">*</span><span class="n">w22</span><span class="p">)</span><span class="o">/</span><span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">w31</span><span class="o">*</span><span class="n">w32</span><span class="p">)</span><span class="o">/</span><span class="n">b2</span><span class="p">)</span>

     <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">w12</span><span class="o">*</span><span class="n">w12</span> <span class="o">+</span> <span class="n">w22</span><span class="o">*</span><span class="n">w22</span><span class="p">)</span><span class="o">/</span><span class="n">a2</span> <span class="o">+</span> <span class="n">w32</span><span class="o">*</span><span class="n">w32</span><span class="o">/</span><span class="n">b2</span>

 	

     <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>

         <span class="n">xx</span> <span class="o">=</span> <span class="mf">0.0</span>

     <span class="k">else</span><span class="p">:</span> 

        <span class="n">K</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">B</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">K</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>

        <span class="n">xx</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

        <span class="n">yy</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">x</span>

      

     <span class="n">dist1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">-</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="o">-</span><span class="n">xx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">yr</span><span class="o">-</span><span class="n">yy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="o">-</span><span class="n">yy</span><span class="p">)</span>

     <span class="n">dist2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">+</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="o">+</span><span class="n">xx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">yr</span><span class="o">+</span><span class="n">yy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="o">+</span><span class="n">yy</span><span class="p">)</span>

 	

     <span class="k">if</span> <span class="n">dist1</span> <span class="o">&gt;</span> <span class="n">dist2</span><span class="p">:</span>

        <span class="n">xx</span> <span class="o">=</span> <span class="o">-</span><span class="n">xx</span>

     

     <span class="n">tx</span> <span class="o">=</span> <span class="n">w11</span><span class="o">*</span><span class="n">xx</span> <span class="o">+</span> <span class="n">w12</span><span class="o">*</span><span class="n">yr</span>

     <span class="n">ty</span> <span class="o">=</span> <span class="n">w21</span><span class="o">*</span><span class="n">xx</span> <span class="o">+</span> <span class="n">w22</span><span class="o">*</span><span class="n">yr</span>

     <span class="n">tz</span> <span class="o">=</span> <span class="n">w31</span><span class="o">*</span><span class="n">xx</span> <span class="o">+</span> <span class="n">w32</span><span class="o">*</span><span class="n">yr</span>

     

     <span class="k">return</span> <span class="n">tx</span><span class="p">,</span><span class="n">ty</span><span class="p">,</span><span class="n">tz</span></div>

 

<div class="viewcode-block" id="quaternion2ECEF"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.quaternion2ECEF">[docs]</a><span class="k">def</span> <span class="nf">quaternion2ECEF</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>

    

<span class="c1">#This function takes a quaternion look vector in ECEF system and converts </span>

<span class="c1">#to a unit look vector in the same system</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># q = Quaternion in ECEF system</span>



<span class="c1"># Output</span>

<span class="c1"># dx = unit look vector</span>

<span class="c1"># dy = unit look vector</span>

<span class="c1"># dz = unit look vector</span>



    <span class="n">M</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">quaternion_matrix</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">dy</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">dz</span> <span class="o">=</span> <span class="o">-</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span></div>



<div class="viewcode-block" id="ECEF2lla"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.ECEF2lla">[docs]</a><span class="k">def</span> <span class="nf">ECEF2lla</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>

<span class="c1">#This function takes a position in ECEF and converts to geodetic position</span>

<span class="c1">#(lon,lat,alt above ellipsiod)</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># x = Position in ECEF (m)</span>

<span class="c1"># y = Position in ECEF (m)</span>

<span class="c1"># z = Position in ECEF (m)</span>



<span class="c1"># Output</span>

<span class="c1"># lon = geodetic latitude (WGS-84)</span>

<span class="c1"># lat = geodetic latitude (WGS-84)</span>

<span class="c1"># alt = altitude above ellipsoid (m)</span>



<span class="c1">#FIXME: check if obstime is needed</span>



    <span class="n">el</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">from_geocentric</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">to_geodetic</span><span class="p">()</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="n">geo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">lon</span> <span class="o">=</span> <span class="n">geo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">alt</span> <span class="o">=</span> <span class="n">geo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">alt</span></div>



    

<div class="viewcode-block" id="lla2ECEF"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.lla2ECEF">[docs]</a><span class="k">def</span> <span class="nf">lla2ECEF</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">alt</span><span class="p">):</span>

<span class="c1">#This function takes a position geodetic position (lon,lat,alt above ellipsiod)</span>

<span class="c1">#and converts into ECEF coodinates</span>

<span class="c1">#</span>



<span class="c1"># Input</span>

<span class="c1"># lon = geodetic latitude (WGS-84)</span>

<span class="c1"># lat = geodetic latitude (WGS-84)</span>

<span class="c1"># alt = altitude above ellipsoid (m)</span>



<span class="c1"># Output</span>

<span class="c1"># x = Position in ECEF (m)</span>

<span class="c1"># y = Position in ECEF (m)</span>

<span class="c1"># z = Position in ECEF (m)</span>





<span class="c1">#FIXME: check if obstime is needed</span>



    <span class="n">el</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">from_geodetic</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">alt</span><span class="p">)</span>

    <span class="n">ecef</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get_itrs</span><span class="p">()</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">ecef</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> 

    <span class="n">y</span> <span class="o">=</span> <span class="n">ecef</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">ecef</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value</span> 

    

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span></div>



<div class="viewcode-block" id="ecef2eci"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.ecef2eci">[docs]</a><span class="k">def</span> <span class="nf">ecef2eci</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>

    

<span class="c1">#This function takes a position in the ECI-J2000 corrdinate system and returns it </span>

<span class="c1">#in ECEF.</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># x = ECI X-coordinate (m)</span>

<span class="c1"># y = ECI Y-coordinate (m)</span>

<span class="c1"># z = ECI Z-coordinate (m)</span>

<span class="c1"># dt = UTC time (datetime object)</span>

<span class="c1">#</span>

<span class="c1">#</span>

<span class="c1"># Output </span>

<span class="c1">#</span>

        

    <span class="c1"># convert datetime object to astropy time object</span>

    <span class="n">tt</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>



    <span class="c1"># Read the coordinates in the Geocentric Celestial Reference System</span>

    <span class="n">itrs</span> <span class="o">=</span> <span class="n">ITRS</span><span class="p">(</span><span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">),</span> <span class="n">obstime</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span>



    <span class="c1"># Convert it to an Earth-fixed frame</span>

    <span class="n">gcrs</span> <span class="o">=</span> <span class="n">itrs</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">GCRS</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="n">tt</span><span class="p">))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">gcrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">x</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">gcrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">y</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">gcrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">z</span>

    

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span></div>





<div class="viewcode-block" id="eci2ecef"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.eci2ecef">[docs]</a><span class="k">def</span> <span class="nf">eci2ecef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>

    

<span class="c1">#This function takes a position in the ECI-J2000 corrdinate system and returns it </span>

<span class="c1">#in ECEF.</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># x = ECI X-coordinate (m)</span>

<span class="c1"># y = ECI Y-coordinate (m)</span>

<span class="c1"># z = ECI Z-coordinate (m)</span>

<span class="c1"># dt = UTC time (datetime object)</span>

<span class="c1">#</span>

<span class="c1">#</span>

<span class="c1"># Output </span>

<span class="c1">#</span>

        

    <span class="c1"># convert datetime object to astropy time object</span>

    <span class="n">tt</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>



    <span class="c1"># Read the coordinates in the Geocentric Celestial Reference System</span>

    <span class="n">gcrs</span> <span class="o">=</span> <span class="n">GCRS</span><span class="p">(</span><span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">km</span><span class="p">),</span> <span class="n">obstime</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span>



    <span class="c1"># Convert it to an Earth-fixed frame</span>

    <span class="n">itrs</span> <span class="o">=</span> <span class="n">gcrs</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">ITRS</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="n">tt</span><span class="p">))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">itrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">x</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">itrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">y</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">itrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">z</span>

    

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span></div>





<div class="viewcode-block" id="SZAfromlla"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.SZAfromlla">[docs]</a><span class="k">def</span> <span class="nf">SZAfromlla</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">alt</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>

    

<span class="c1">#This function takes a geodetic position and calculates the solar zenith </span>

<span class="c1">#angle from this</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># lon = geodetic latitude (WGS-84)</span>

<span class="c1"># lat = geodetic latitude (WGS-84)</span>

<span class="c1"># alt = altitude above ellipsoid (m)</span>

<span class="c1"># dt = datetime object</span>

<span class="c1">#</span>

<span class="c1">#</span>

<span class="c1"># Output </span>

<span class="c1">#</span>

<span class="c1"># sza = solar zenith angle (deg)</span>

        

    

    <span class="c1"># convert datetime object to astropy time object</span>

    <span class="n">tt</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>

    

    <span class="c1">#get position of point</span>

    <span class="n">el</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">from_geodetic</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">alt</span><span class="p">)</span>    

    <span class="c1">#get position of sun</span>

    <span class="n">sun</span> <span class="o">=</span> <span class="n">get_sun</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1">#convert posion to skyangle</span>

    <span class="n">sun_ang</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">AltAz</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="n">el</span><span class="p">))</span>

    <span class="c1">#get SZA</span>

    <span class="n">SZA</span> <span class="o">=</span> <span class="n">sun_ang</span><span class="o">.</span><span class="n">zen</span><span class="o">.</span><span class="n">value</span>

    

    <span class="k">return</span> <span class="n">SZA</span></div>



<div class="viewcode-block" id="find_orbit_plane"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.find_orbit_plane">[docs]</a><span class="k">def</span> <span class="nf">find_orbit_plane</span><span class="p">(</span><span class="n">satpos1_eci_1</span><span class="p">,</span><span class="n">satpos2_eci</span><span class="p">):</span>

    

    <span class="n">n</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">satpos1_eci_1</span><span class="p">,</span><span class="n">satpos2_eci</span><span class="p">)</span>

    <span class="n">n_norm</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    

    <span class="k">return</span> <span class="n">n_norm</span></div>



<div class="viewcode-block" id="los_from_tanpoint_spherical"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.los_from_tanpoint_spherical">[docs]</a><span class="k">def</span> <span class="nf">los_from_tanpoint_spherical</span><span class="p">(</span><span class="n">satpos1_eci_1</span><span class="p">,</span><span class="n">satpos2_eci</span><span class="p">):</span>

    

    <span class="n">n</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">satpos1_eci_1</span><span class="p">,</span><span class="n">satpos2_eci</span><span class="p">)</span>

    <span class="n">n_norm</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    

    <span class="k">return</span> <span class="n">n_norm</span></div>





<div class="viewcode-block" id="starlist_from_ra_dec"><a class="viewcode-back" href="../../Operational_Planning_Tool.html#Operational_Planning_Tool._MATS_coordinates.starlist_from_ra_dec">[docs]</a><span class="k">def</span> <span class="nf">starlist_from_ra_dec</span><span class="p">(</span><span class="n">ra_in</span><span class="p">,</span><span class="n">dec_in</span><span class="p">,</span><span class="n">width_in</span><span class="p">,</span><span class="n">height_in</span><span class="p">,</span><span class="n">Vmag</span><span class="p">):</span>

    

<span class="c1">#This function takes a pointing in right acencion, declination (J2000) and give a </span>

<span class="c1">#list of stars with magnitude &gt; Vmag in the region specified by width and height. </span>

<span class="c1">#It uses the I/332A (UCAC4) database.</span>

<span class="c1">#</span>

<span class="c1"># Input</span>

<span class="c1"># ra_in = Right-Acencion (J2000)</span>

<span class="c1"># dec_in = Declination (J2000)</span>

<span class="c1"># width_in = width of FoV (degrees)</span>

<span class="c1"># height_in = height of FoV (degrees)</span>

<span class="c1"># Vmag = Vmag of brightest star to return</span>

<span class="c1">#</span>

<span class="c1">#</span>

<span class="c1"># Output </span>

<span class="c1">#</span>

<span class="c1"># star_table = table of stars</span>



    <span class="n">v</span> <span class="o">=</span> <span class="n">Vizier</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_RAJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;_DEJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;Vmag&#39;</span><span class="p">],</span> <span class="n">column_filters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Vmag&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Vmag</span><span class="p">)})</span>



    <span class="n">star_catalog</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;I/322A&quot;</span><span class="p">]</span>

    <span class="n">width_instrument</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">width_in</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

    <span class="n">height_instrument</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">height_in</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

    <span class="n">star_table</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra_in</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec_in</span><span class="p">,</span>

                                            <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span><span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">),</span>

                            <span class="n">width_instrument</span><span class="p">,</span><span class="n">height_instrument</span><span class="p">,</span><span class="n">catalog</span><span class="o">=</span><span class="n">star_catalog</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">star_table</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Operational_Planning_Tool</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Operational_Planning_Tool.html">Operational_Planning_Tool package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../Operational_Planning_Tool.html">Operational_Planning_Tool</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, David Skånberg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>